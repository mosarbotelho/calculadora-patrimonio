<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Autenticação do Firebase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
        }
        .container {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
            text-align: center;
        }
        h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        p {
            font-size: 1rem;
            color: #4b5563;
        }
        .status-box {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: 0.75rem;
            background-color: #e5e7eb;
            color: #374151;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Status de Autenticação</h1>
        <p>Verificando o status da sua conexão com o Firebase...</p>
        <div id="auth-status" class="status-box">Carregando...</div>
    </div>

    <script type="module">
        // Importa as funções necessárias do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Variáveis globais para os serviços do Firebase
        let app, auth, db, userId;

        // Tenta parsear a configuração do Firebase do ambiente
        let firebaseConfig = {};
        try {
            firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        } catch (e) {
            console.error("Erro ao parsear a configuração do Firebase:", e);
        }

        // Tenta obter o token de autenticação personalizado
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Exibe o status de autenticação no DOM
        const statusElement = document.getElementById('auth-status');

        // Inicializa o Firebase apenas se a configuração for válida
        if (Object.keys(firebaseConfig).length > 0) {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);

            // Listener para o estado de autenticação
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    statusElement.textContent = `Autenticado com sucesso! ID do usuário: ${userId}`;
                    console.log("Usuário autenticado:", userId);
                } else {
                    console.log("Nenhum usuário logado. Tentando login anônimo...");
                    statusElement.textContent = "Tentando autenticação...";
                    try {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                            console.log("Login com token personalizado bem-sucedido.");
                        } else {
                            await signInAnonymously(auth);
                            console.log("Login anônimo bem-sucedido.");
                        }
                    } catch (error) {
                        console.error("Erro de Autenticação do Firebase:", error);
                        statusElement.textContent = `Erro na autenticação: ${error.message}`;
                    }
                }
            });
        } else {
            statusElement.textContent = 'Configuração do Firebase ausente ou inválida.';
            console.error("Configuração do Firebase ausente ou inválida.");
        }
    </script>

</body>
</html>
